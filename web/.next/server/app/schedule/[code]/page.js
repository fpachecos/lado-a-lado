(()=>{var e={};e.id=840,e.ids=[840],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},6250:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>u,tree:()=>d});var a=t(260),r=t(8203),o=t(5155),n=t.n(o),i=t(7292),l={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);t.d(s,l);let d=["",{children:["schedule",{children:["[code]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,4538)),"/Users/fipacheco/lado-a-lado/web/app/schedule/[code]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,9611)),"/Users/fipacheco/lado-a-lado/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9937,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/fipacheco/lado-a-lado/web/app/schedule/[code]/page.tsx"],m={require:t,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/schedule/[code]/page",pathname:"/schedule/[code]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},6891:()=>{},35:()=>{},3395:(e,s,t)=>{Promise.resolve().then(t.bind(t,7022))},9051:(e,s,t)=>{Promise.resolve().then(t.bind(t,8938))},487:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,3219,23)),Promise.resolve().then(t.t.bind(t,4863,23)),Promise.resolve().then(t.t.bind(t,5155,23)),Promise.resolve().then(t.t.bind(t,9350,23)),Promise.resolve().then(t.t.bind(t,6313,23)),Promise.resolve().then(t.t.bind(t,8530,23)),Promise.resolve().then(t.t.bind(t,8921,23))},5983:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,6959,23)),Promise.resolve().then(t.t.bind(t,3875,23)),Promise.resolve().then(t.t.bind(t,8903,23)),Promise.resolve().then(t.t.bind(t,4178,23)),Promise.resolve().then(t.t.bind(t,6013,23)),Promise.resolve().then(t.t.bind(t,7190,23)),Promise.resolve().then(t.t.bind(t,1365,23))},8938:(e,s,t)=>{"use strict";t.d(s,{default:()=>l});var a=t(5512),r=t(8009),o=t(9334);function n(e){return e.slice(0,5)}function i(e){return new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}function l({schedule:e,slots:s,bookings:t}){let l=(0,o.useRouter)(),[d,c]=(0,r.useState)(null),[m,u]=(0,r.useState)(""),[p,x]=(0,r.useState)(1),[h,f]=(0,r.useState)(!1),[g,b]=(0,r.useState)(null),[v,j]=(0,r.useState)(null),[y,N]=(0,r.useState)(!1),[_,P]=(0,r.useState)(null),[S,w]=(0,r.useState)(!1),C=(0,r.useMemo)(()=>{let e=new Map;for(let s of t)e.set(s.slot_id,(e.get(s.slot_id)??0)+s.number_of_people);return s.map(s=>{let t=e.get(s.id)??0,a=Math.max(0,s.max_people-t);return{...s,total_people:t,remaining_spots:a}})},[s,t]),I=async e=>{if(e.preventDefault(),b(null),j(null),!d){b("Selecione um hor\xe1rio para agendar.");return}if(!m.trim()){b("Informe seu nome.");return}if(p<1){b("O n\xfamero de pessoas deve ser pelo menos 1.");return}f(!0);try{let e=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slotId:d,visitorName:m.trim(),numberOfPeople:p,replaceExisting:y||!!_})}),s=await e.json();if(!e.ok){"ALREADY_BOOKED"===s.code?(N(!0),b('Voc\xea j\xe1 possui um agendamento nesta agenda. Clique em "Mudar agendamento" para substituir pelo novo hor\xe1rio.')):b(s.message??"N\xe3o foi poss\xedvel realizar o agendamento.");return}w(!1),N(!1),j("Agendamento realizado com sucesso!"),l.refresh()}catch(e){console.error(e),b("Ocorreu um erro ao se comunicar com o servidor.")}finally{f(!1)}},k=C.find(e=>(e.id===d)??"");return(0,a.jsxs)("main",{className:"flex flex-1 flex-col gap-6",children:[(0,a.jsxs)("header",{className:"space-y-2",children:[(0,a.jsx)("span",{className:"pill",children:"Lado a Lado"}),(0,a.jsx)("h1",{className:"text-2xl font-semibold",style:{color:"#333333"},children:"Agendamento de Visitas"}),(0,a.jsx)("p",{className:"text-sm",style:{color:"#666666"},children:"Escolha um hor\xe1rio dispon\xedvel na agenda para realizar sua visita."}),e.custom_message?(0,a.jsx)("p",{className:"card",style:{padding:10,fontSize:12,background:"linear-gradient(135deg, rgba(255,255,255,0.9), rgba(168,213,186,0.9))",borderColor:"rgba(168,213,186,0.9)"},children:e.custom_message}):null,(0,a.jsxs)("p",{className:"text-xs",style:{color:"#666666"},children:["Per\xedodo da agenda: ",i(e.start_date)," at\xe9"," ",i(e.end_date)]})]}),_&&(0,a.jsxs)("section",{className:"space-y-2",children:[(0,a.jsx)("h2",{className:"text-sm font-medium",children:"Seu agendamento nesta agenda"}),(0,a.jsx)("div",{className:"card",style:{padding:10,fontSize:12,display:"flex",flexDirection:"column",gap:4},children:(()=>{let e=C.find(e=>e.id===_.slotId);return e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{style:{color:"#333333"},children:(0,a.jsx)("strong",{children:_.visitorName})}),(0,a.jsxs)("p",{style:{color:"#666666"},children:[i(e.date)," \xe0s ",n(e.start_time)]}),(0,a.jsxs)("p",{style:{color:"#666666"},children:["Dura\xe7\xe3o: ",e.duration_minutes," minutos"]}),(0,a.jsxs)("p",{style:{color:"#666666"},children:["N\xfamero de pessoas agendadas: ",_.numberOfPeople]})]}):(0,a.jsx)("p",{style:{color:"#666666"},children:"Hor\xe1rio n\xe3o encontrado."})})()}),!S&&(0,a.jsx)("button",{type:"button",className:"primary-button",style:{marginTop:12},onClick:()=>w(!0),children:"Mudar agendamento"})]}),(!_||S)&&(0,a.jsxs)("section",{className:"space-y-3",children:[(0,a.jsx)("h2",{className:"text-sm font-medium",children:"Hor\xe1rios dispon\xedveis"}),0===C.length?(0,a.jsx)("p",{className:"text-sm",style:{color:"#666666"},children:"Nenhum hor\xe1rio dispon\xedvel nesta agenda no momento."}):(0,a.jsx)("div",{className:"card",style:{maxHeight:320,padding:8,display:"flex",flexDirection:"column",gap:8,overflowY:"auto"},children:C.map(e=>{let s=e.remaining_spots<=0,t=e.id===d;return(0,a.jsxs)("button",{type:"button",onClick:()=>c(e.id),disabled:s,className:`flex items-center justify-between px-3 py-2 text-left text-xs card ${s?"opacity-60":""}`,style:{background:t?"linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,111,97,0.12))":"rgba(255,255,255,0.8)",borderColor:t?"#ff6f61":"rgba(255,255,255,0.8)"},children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium",style:{color:"#333333"},children:[i(e.date)," \xe0s ",n(e.start_time)]}),(0,a.jsxs)("div",{className:"mt-0.5 text-[11px]",style:{color:"#666666"},children:["Dura\xe7\xe3o aproximada: ",e.duration_minutes," minutos"]})]}),(0,a.jsx)("div",{className:"text-right text-[11px]",style:{color:"#666666"},children:s?"Lotado":`${e.remaining_spots} vaga(s) restante(s) de ${e.max_people}`})]},e.id)})})]}),(!_||S)&&(0,a.jsxs)("section",{className:"space-y-3",children:[(0,a.jsx)("h2",{className:"text-sm font-medium",children:"Dados do visitante"}),(0,a.jsxs)("form",{onSubmit:I,className:"flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,a.jsx)("label",{className:"text-xs font-medium",htmlFor:"name",children:"Seu nome completo"}),(0,a.jsx)("input",{id:"name",value:m,onChange:e=>u(e.target.value),className:"input",placeholder:"Ex: Maria Silva"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,a.jsx)("label",{className:"text-xs font-medium",htmlFor:"people",children:"N\xfamero total de pessoas na visita"}),(0,a.jsx)("input",{id:"people",type:"number",min:1,value:p,onChange:e=>x(Number(e.target.value)||1),className:"input",style:{width:120}})]}),k?(0,a.jsxs)("p",{className:"text-[11px]",style:{color:"#666666"},children:["Voc\xea selecionou:"," ",(0,a.jsxs)("span",{className:"font-medium",children:[i(k.date)," \xe0s ",n(k.start_time)]}),"."]}):(0,a.jsx)("p",{className:"text-[11px]",style:{color:"#666666"},children:"Selecione um hor\xe1rio na lista acima para continuar."}),g&&(0,a.jsx)("p",{className:"card",style:{padding:8,fontSize:12,color:"#ff3b30",borderColor:"#ff3b30",background:"rgba(255, 59, 48, 0.08)"},children:g}),v&&(0,a.jsx)("p",{className:"card",style:{padding:8,fontSize:12,color:"#34c759",borderColor:"#34c759",background:"rgba(52, 199, 89, 0.08)"},children:v}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,a.jsx)("button",{type:"submit",disabled:h,className:"primary-button",children:y?"Mudar agendamento":"Agendar visita"}),y&&(0,a.jsx)("p",{className:"text-[11px]",style:{color:"#666666"},children:"Ao confirmar, seu agendamento anterior ser\xe1 apagado e substitu\xeddo pelo novo hor\xe1rio."})]})]})]})]})}},9334:(e,s,t)=>{"use strict";var a=t(8686);t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})},9611:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>o,metadata:()=>r});var a=t(2740);t(2704);let r={title:"Agendamento de Visitas - Lado a Lado",description:"P\xe1gina p\xfablica para agendamento de visitas em agendas compartilhadas."};function o({children:e}){return(0,a.jsx)("html",{lang:"pt-BR",children:(0,a.jsx)("body",{children:(0,a.jsx)("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",padding:"32px 16px"},children:(0,a.jsx)("div",{className:"card",style:{width:"100%",maxWidth:640,padding:24,display:"flex",flexDirection:"column",gap:24},children:e})})})})}},4538:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n});var a=t(2740),r=t(3865),o=t(7022);async function n({params:e}){let{code:s}=await e,{data:t,error:n}=await r.N.from("visit_slots").select("id, date, start_time, duration_minutes, max_people, is_skipped").eq("schedule_id",s).eq("is_skipped",!1).order("date",{ascending:!0}).order("start_time",{ascending:!0});if(n&&console.error(n),console.log("Slots fetched:",s),!t||0===t.length)return(0,a.jsxs)("main",{className:"flex flex-1 flex-col justify-center gap-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Agenda n\xe3o encontrada"}),(0,a.jsx)("p",{className:"text-sm text-slate-300",children:"Verifique se o c\xf3digo da agenda est\xe1 correto ou pe\xe7a um novo link no aplicativo."})]});let i=t.map(e=>e.id),{data:l,error:d}=await r.N.from("visit_bookings").select("id, slot_id, visitor_name, number_of_people").in("slot_id",i);d&&console.error(d);let c=t.map(e=>e.date),m=c.reduce((e,s)=>s<e?s:e,c[0]),u=c.reduce((e,s)=>s>e?s:e,c[0]);return(0,a.jsx)(o.default,{schedule:{id:s,custom_message:null,start_date:m,end_date:u},slots:t,bookings:l??[]})}},7022:(e,s,t)=>{"use strict";t.d(s,{default:()=>a});let a=(0,t(6760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/fipacheco/lado-a-lado/web/app/schedule/[code]/schedule-client.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/fipacheco/lado-a-lado/web/app/schedule/[code]/schedule-client.tsx","default")},3865:(e,s,t)=>{"use strict";t.d(s,{N:()=>n});var a=t(7752);let r="https://xstsbaexisgxebgydtyj.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhzdHNiYWV4aXNneGViZ3lkdHlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4NTI0MDQsImV4cCI6MjA4MDQyODQwNH0.YkpF7IEmdnTqZH0vSbFygaSD9wa6yd4j7aLLf2Zen28";r&&o||console.warn("Vari\xe1veis NEXT_PUBLIC_SUPABASE_URL e/ou NEXT_PUBLIC_SUPABASE_ANON_KEY n\xe3o est\xe3o definidas.");let n=(0,a.UU)(r??"",o??"",{db:{schema:"ladoalado"}})},2704:()=>{}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[989,112,752],()=>t(6250));module.exports=a})();