(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[840],{3029:(e,a,s)=>{Promise.resolve().then(s.bind(s,2692))},2692:(e,a,s)=>{"use strict";s.d(a,{default:()=>i});var t=s(5155),o=s(2115),l=s(6046);function r(e){return e.slice(0,5)}function n(e){return new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}function i(e){let{schedule:a,slots:s,bookings:i}=e,c=(0,l.useRouter)(),[d,m]=(0,o.useState)(null),[u,p]=(0,o.useState)(""),[x,h]=(0,o.useState)(1),[g,f]=(0,o.useState)(!1),[N,b]=(0,o.useState)(null),[j,y]=(0,o.useState)(null),[v,_]=(0,o.useState)(!1),[S,k]=(0,o.useState)(null),[w,O]=(0,o.useState)(!1),C=(0,o.useMemo)(()=>{let e=new Map;for(let s of i){var a;e.set(s.slot_id,(null!==(a=e.get(s.slot_id))&&void 0!==a?a:0)+s.number_of_people)}return s.map(a=>{var s;let t=null!==(s=e.get(a.id))&&void 0!==s?s:0,o=Math.max(0,a.max_people-t);return{...a,total_people:t,remaining_spots:o}})},[s,i]);(0,o.useEffect)(()=>{let e="ladoalado_schedule_booking_".concat(a.id),s=window.localStorage.getItem(e);if(s)try{let e=JSON.parse(s);k(e),m(e.slotId),p(e.visitorName),h(e.numberOfPeople)}catch(e){}},[a.id]);let D=async e=>{if(e.preventDefault(),b(null),y(null),!d){b("Selecione um hor\xe1rio para agendar.");return}if(!u.trim()){b("Informe seu nome.");return}if(x<1){b("O n\xfamero de pessoas deve ser pelo menos 1.");return}f(!0);try{let e=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slotId:d,visitorName:u.trim(),numberOfPeople:x,replaceExisting:v||!!S})}),t=await e.json();if(!e.ok){if("ALREADY_BOOKED"===t.code)_(!0),b('Voc\xea j\xe1 possui um agendamento nesta agenda. Clique em "Mudar agendamento" para substituir pelo novo hor\xe1rio.');else{var s;b(null!==(s=t.message)&&void 0!==s?s:"N\xe3o foi poss\xedvel realizar o agendamento.")}return}{let e={slotId:d,visitorName:u.trim(),numberOfPeople:x};window.localStorage.setItem("ladoalado_schedule_booking_".concat(a.id),JSON.stringify(e)),k(e)}O(!1),_(!1),y("Agendamento realizado com sucesso!"),c.refresh()}catch(e){console.error(e),b("Ocorreu um erro ao se comunicar com o servidor.")}finally{f(!1)}},P=C.find(e=>e.id===(null!=d?d:""));return(0,t.jsxs)("main",{className:"flex flex-1 flex-col gap-6",children:[(0,t.jsxs)("header",{className:"space-y-2",children:[(0,t.jsx)("span",{className:"pill",children:"Lado a Lado"}),(0,t.jsx)("h1",{className:"text-2xl font-semibold",style:{color:"#333333"},children:"Agendamento de Visitas"}),(0,t.jsx)("p",{className:"text-sm",style:{color:"#666666"},children:"Escolha um hor\xe1rio dispon\xedvel na agenda para realizar sua visita."}),a.custom_message?(0,t.jsx)("p",{className:"card",style:{padding:10,fontSize:12,background:"linear-gradient(135deg, rgba(255,255,255,0.9), rgba(168,213,186,0.9))",borderColor:"rgba(168,213,186,0.9)"},children:a.custom_message}):null,(0,t.jsxs)("p",{className:"text-xs",style:{color:"#666666"},children:["Per\xedodo da agenda: ",n(a.start_date)," at\xe9"," ",n(a.end_date)]})]}),S&&(0,t.jsxs)("section",{className:"space-y-2",children:[(0,t.jsx)("h2",{className:"text-sm font-medium",children:"Seu agendamento nesta agenda"}),(0,t.jsx)("div",{className:"card",style:{padding:10,fontSize:12,display:"flex",flexDirection:"column",gap:4},children:(()=>{let e=C.find(e=>e.id===S.slotId);return e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{style:{color:"#333333"},children:(0,t.jsx)("strong",{children:S.visitorName})}),(0,t.jsxs)("p",{style:{color:"#666666"},children:[n(e.date)," \xe0s ",r(e.start_time)]}),(0,t.jsxs)("p",{style:{color:"#666666"},children:["Dura\xe7\xe3o: ",e.duration_minutes," minutos"]}),(0,t.jsxs)("p",{style:{color:"#666666"},children:["N\xfamero de pessoas agendadas: ",S.numberOfPeople]})]}):(0,t.jsx)("p",{style:{color:"#666666"},children:"Hor\xe1rio n\xe3o encontrado."})})()}),!w&&(0,t.jsx)("button",{type:"button",className:"primary-button",style:{marginTop:12},onClick:()=>O(!0),children:"Mudar agendamento"})]}),(!S||w)&&(0,t.jsxs)("section",{className:"space-y-3",children:[(0,t.jsx)("h2",{className:"text-sm font-medium",children:"Hor\xe1rios dispon\xedveis"}),0===C.length?(0,t.jsx)("p",{className:"text-sm",style:{color:"#666666"},children:"Nenhum hor\xe1rio dispon\xedvel nesta agenda no momento."}):(0,t.jsx)("div",{className:"card",style:{maxHeight:320,padding:8,display:"flex",flexDirection:"column",gap:8,overflowY:"auto"},children:C.map(e=>{let a=e.remaining_spots<=0,s=e.id===d;return(0,t.jsxs)("button",{type:"button",onClick:()=>m(e.id),disabled:a,className:"flex items-center justify-between px-3 py-2 text-left text-xs ".concat("card"," ").concat(a?"opacity-60":""),style:{background:s?"linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,111,97,0.12))":"rgba(255,255,255,0.8)",borderColor:s?"#ff6f61":"rgba(255,255,255,0.8)"},children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-medium",style:{color:"#333333"},children:[n(e.date)," \xe0s ",r(e.start_time)]}),(0,t.jsxs)("div",{className:"mt-0.5 text-[11px]",style:{color:"#666666"},children:["Dura\xe7\xe3o aproximada: ",e.duration_minutes," minutos"]})]}),(0,t.jsx)("div",{className:"text-right text-[11px]",style:{color:"#666666"},children:a?"Lotado":"".concat(e.remaining_spots," vaga(s) restante(s) de ").concat(e.max_people)})]},e.id)})})]}),(!S||w)&&(0,t.jsxs)("section",{className:"space-y-3",children:[(0,t.jsx)("h2",{className:"text-sm font-medium",children:"Dados do visitante"}),(0,t.jsxs)("form",{onSubmit:D,className:"flex flex-col gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)("label",{className:"text-xs font-medium",htmlFor:"name",children:"Seu nome completo"}),(0,t.jsx)("input",{id:"name",value:u,onChange:e=>p(e.target.value),className:"input",placeholder:"Ex: Maria Silva"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)("label",{className:"text-xs font-medium",htmlFor:"people",children:"N\xfamero total de pessoas na visita"}),(0,t.jsx)("input",{id:"people",type:"number",min:1,value:x,onChange:e=>h(Number(e.target.value)||1),className:"input",style:{width:120}})]}),P?(0,t.jsxs)("p",{className:"text-[11px]",style:{color:"#666666"},children:["Voc\xea selecionou:"," ",(0,t.jsxs)("span",{className:"font-medium",children:[n(P.date)," \xe0s ",r(P.start_time)]}),"."]}):(0,t.jsx)("p",{className:"text-[11px]",style:{color:"#666666"},children:"Selecione um hor\xe1rio na lista acima para continuar."}),N&&(0,t.jsx)("p",{className:"card",style:{padding:8,fontSize:12,color:"#ff3b30",borderColor:"#ff3b30",background:"rgba(255, 59, 48, 0.08)"},children:N}),j&&(0,t.jsx)("p",{className:"card",style:{padding:8,fontSize:12,color:"#34c759",borderColor:"#34c759",background:"rgba(52, 199, 89, 0.08)"},children:j}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsx)("button",{type:"submit",disabled:g,className:"primary-button",children:v?"Mudar agendamento":"Agendar visita"}),v&&(0,t.jsx)("p",{className:"text-[11px]",style:{color:"#666666"},children:"Ao confirmar, seu agendamento anterior ser\xe1 apagado e substitu\xeddo pelo novo hor\xe1rio."})]})]})]})]})}},6046:(e,a,s)=>{"use strict";var t=s(6658);s.o(t,"useRouter")&&s.d(a,{useRouter:function(){return t.useRouter}}),s.o(t,"useSearchParams")&&s.d(a,{useSearchParams:function(){return t.useSearchParams}})}},e=>{var a=a=>e(e.s=a);e.O(0,[441,517,358],()=>a(3029)),_N_E=e.O()}]);